<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>qr</title>
  <style>
    html,body{height:100%;margin:0;background:#fff;display:flex;justify-content:center;align-items:center}
    canvas{max-width:96vmin;max-height:96vmin;}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/qrcode-generator@2.0.4/dist/qrcode.min.js"></script>
</head>
<body>
  <canvas id="qr"></canvas>
  <script>
    (function(){
      function getParam(name){
        const url = new URL(location.href);
        return url.searchParams.get(name);
      }
      const q = getParam('q');
      if(!q){
        // no data, keep page blank
        return;
      }

      // create QR code using qrcode-generator
      const typeNumber = 0; // 0 = automatic
      const errorCorrectionLevel = 'L';
      const qr = qrcode(typeNumber, errorCorrectionLevel);
      qr.addData(q);
      qr.make();

      // render to canvas
      const canvas = document.getElementById('qr');
      const ctx = canvas.getContext('2d');
      const cellSize = 8;
      const margin = cellSize * 4;
      const moduleCount = qr.getModuleCount();
      canvas.width = canvas.height = moduleCount * cellSize + margin * 2;
      ctx.fillStyle = '#fff';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = '#000';
      for(let row=0; row<moduleCount; row++){
        for(let col=0; col<moduleCount; col++){
          if(qr.isDark(row,col)){
            ctx.fillRect(col*cellSize + margin, row*cellSize + margin, cellSize, cellSize);
          }
        }
      }
    })();
  </script>
</body>
</html>
